1，光

2，镜头
			
			针孔模型:
			基于高斯光学的透镜模型：
			远心镜头：
			
			景深：
			镜头像差：
					球差：近轴光线和远轴光线通过镜头后不能交于一点。产生一个弥散圆。
								解决办法：1，使用较大的f数，使用较小的通光圈可以阻止远离光轴的管线通过镜头。
													2，使用非球面镜头。
					慧差：与光轴成一定角度的光线通过镜头后不能聚于一点，产生彗星形状的图形。非对称。会导致
					         边缘提取算法得到错误的位置。
					      解决办法：使用大的f数来减少慧差。
					像散：轴外物点发出的在子午平面和弧矢平面的光线通过镜头后不能聚在一点。而是聚成两条短线
								子午平面：轴外物点和光线所定义的平面
								弧矢平面：通过光轴与子午平面互相垂直的平面
								->解决办法：使用大f数的孔径光澜或者仔细设计镜头减小像散。
					场曲：子午平面和弧矢平面位于两个弯曲的焦面上。一般图像中心清晰，边缘焦散严重。
								解决办法同像散。
				----------	以上除了慧差外都会影响图像聚焦。使得不经过镜头后成的像不再是直线。导致有枕形失真和桶形失真
				
				如果被白光或者多波长光照明。还会产生色差。
				对于色差，如果是彩色照相机，色差会在物体边缘产生彩条。而对于黑白相机，色差产生模糊。
						使用大f数的孔径光澜或者仔细设计镜头减小像散。
					
3	相机
		传感器:
			CCD: 由一行光线敏感的光探测器组成，一般为光栅晶体管或光电二极管。经过传输门到达串行读出寄存器，再经多电荷转换及放大。
	     一个CCD最多由4个门组成。
	     线阵传感器本身必须与被测平面平行并且与运行方向垂直，以保证得到矩形像素。同时，线阵传感器的分辨率、采集频率、被测物的速度相匹配才得到方形像素，数据才有一致性。最好进行摄像机标定来确保测量精度。
						数据读出速度一般在14-140Hz之间，所以必须限制每行的曝光时间。镜头必须f数较小，从而限制了景深。
	     面阵传感器：光在光电探测器中转化为电荷，一行一行地转移到串行读出寄存器。然后进行电荷转换和放大读出。
				隔行转移型传感器：
	 			-----优点：(帧转移型传感器)填充因子可以达到100%，而且不需要机械快门，或闪光灯
	 			-----缺点：高光溢出，图像有拖影存在。同时需要光敏传感器和光屏壁传感器，成本较高。
	 			应用：高灵敏性和拖影等特征，全帧转移型传感器和帧转移型传感器通常用于天文等曝光时间比读取时间长的科学研究领域。


	CMOS:
	
	
	
3.2 Image Enhancement
	
	3.2.1 图像灰度值变换
			f(g) = ag +b
			归一化处理： 	a = (pow(2, b)-1)/(gmax-gmin)
										b = agmin
						缺陷：如果图像中存在一个非常亮或者非常暗的像素值，通过上述的灰度归一化处理无法得到想要的灰度值。
			鲁棒的灰度归一化：利用灰度直方图，将非常亮或非常暗的区域筛除掉，再使用归一化处理。这个在OCR特征提取很有效。
			线性灰度值变换：参数必须根据不同的应用场合和不同的照明进行合理选择
			
	3.2.2 辐射标定
			相机传感器与灰度值方程： G = aE + b  ;  G:灰度值， E: 传感器积累到的能量， 理想b=0, 不影响线性度。
			非线性响应：影响亚像素阈值分割、灰度值特征提取、亚像素边缘提取
			如果非线性响应的图像使用了逆响应，则图像结果就是线性响应的。
			确定逆响应函数的过程就是辐射标定。
			
			相机响应：线性响应和伽马响应
			
			基于图表标定：灰阶卡
					要求：1，整个视野内光照非常均匀，抗干扰能力差  (生产环境可能不符合)
								2，标定板的格式没有标准化，无法实现一个通用的标定算法。
			
			无图表标定：通过不同的曝光实现，改变光圈或者相机曝光时间来实现，一般通过软件的方式来修改曝光时间
									不需要视野光照均匀，也不需要标定板。要求是每幅图像中灰度直方图中不存在空隙。过度曝光也可以被处理。
					灰度与曝光e：G = r(eE)，目的是求其逆函数： q(G) = eE;
					
	
	3.2.3 图像平滑
				图像总是会存在噪声，我们一般假设噪声平稳。噪声主要是图像中灰度值高频波动的方式暴露出来。
				平稳指的是 噪声与图像像素的位置无关，每个像素点，噪声同样的分布。
				
				时域平均法：采集多幅图像进行平均，在X光监测系统中经常使用(X光系统一般存在较多噪声)。
						这样噪声方差降为1/n, 标准差降为1/sqrt(n).
						可通过其中任何一幅图像减去平均图像得到噪声
						缺点：采集多幅图像耗时很多，如果要求快速处理就不行了。
						
				空间平均法：
						窗口(2n+1)x(2m+1)作为掩码，方差降为1/(2n+1)(2m+1)
						缺点：使边缘模糊，不够锐利。(图像并不是遍历的，只有图中亮度一致的区域才是遍历的)。
						
				图像滤波时边界处理：
						1，直接令超出图像部分为0， 这样导致像素越靠近边界越暗
						2，边界以外的像素灰度值等于边界最临近像素点的灰度值，这样导致产生不希望存在的边缘
						3，以边界为中心，令图像外某位置未定义的灰度值等于图像内其镜像位置的灰度值，这样产生的干扰最小。
						
				可分滤波器：如果一个滤波器在运算时分别允许在行、列上求和，则此滤波器称为可分滤波器
						可以提升计算速度
						
				递归滤波器：在前一个计算出值的基础上计算新值
			
				高斯滤波器: 最理想的平滑滤波器；唯一的各向同性的可分平滑滤波器	；不能以递归的方式执行； 比均值滤波器更好的抑制高频部分
									图像更锐利
				
				中值滤波器: 非线性滤波器，算法复杂度O(whn),已优化过！即使是大尺寸的窗口也不会降低边缘的锐利程度。
								不足：处理后图像所包含的边缘是否产生变化，变化程度多少无法预先估计，也不能预计中值滤波器的噪声抑制程度，对高精度的
								       测量任务，首选高斯滤波器。
								    
				
									
						
	
	3.2.4 傅立叶变换
					
					
					对均值、高斯滤波器来说，如果自身尺寸增加，那么滤波器的频率响应将变窄。 对应关系：h(x/a) <=> |a|*H(af) 
					
					离散图像变换过程中可能发生混淆现象，所以图像采集时，需要将高于尼奎斯特临界频率的部分消除。可以通过光学低通滤波器来实现。
					但是，如果是一副图像按比例缩小也可能发生混淆现象。这样，对图像进行低分辨率采样前，先使用平滑滤波消除所有高于尼奎斯特临界频率的高频
					部分是很重要的。
					
					傅立叶滤波：配合线性滤波器(均值、高斯)，在大尺寸滤波器时才有优势。
								另外，可以通过使用定制的滤波器来消除图像中某些特定的频率。(如一些重复出现的纹理，带有周期的性质)
								
					
					
3.3	几何变换
				许多应用中，并不能保证被测物在图像中总是处于同样的位置和方向。因此，首先需要确定被测物的位置和方向，即被测物位姿。
				如，环形OCR识别、旋转的ROI
		3.3.1 仿射变换：可以处理与物体位置有关的变化。以下为齐次坐标表示法
					|r'|   / a11 a12 a13 \
					|c'| = | a21 a22 a23 |
					|1 |	 \ 0   0   1   /
					
					平移：
					      | 1 0 Tr |
					      | 0 1 Tc |
					      
					行、列方向缩放：
					 			| Sr 0 0 |
					 			| 0 Sc 0 |
					 			
					以角度α旋转
								| cosα -sinα 0 |
								| sinα cosα  0 |
								
					以角度θ将纵轴倾斜，在OCR矫正倾斜字符时很有用
								| cosθ 0 0 |
								| sinθ 1 0 |
					
								
		3.3.2 投影变换：在仿射的情况下，如果物体在三围空间有旋转，且表面是平的。
								|r'|		| h11	h12	h13 |		|r|
								|c'| = 	| h21	h22	h23 | * |c|
								|w'|		| h31	h32	h33 | 	|w|
		
		3.3.3 图像变换
						在输出图像中遍历所有像素，并计算其在输入图像中相对应的点的位置，这样保证能够对输出图像中所有相关像素进行设定。
					最近邻域插值：先对转换后像素中心的非整数坐标进行取整处理，找到与此坐标相邻像素中点最近的一个，并在输入图像中，
					              这个最近邻位置的像素灰度值作为输出图像中对应位置的像素点灰度值。
					              -->从最近像素中心取得，容易出现锯齿外观。
					双线性内插法：先确定到相邻像素中心的距离，然后用距离作为他们灰度值的权值重新进行插值计算。
					双线性插值法：变换后的像素中心位于一个正方形中，使用该像素中心到正方形四个顶点的距离以适当的权值进行插值运算。
												权值一定在0-1个像素之间。这种方法处理后非常平滑，但是时间较长，5倍以上的原计算时间。
												
					以上插值算法在图像缩小时，也就是图像二次采样时，可能出现混淆现象。为了改善图像变换结果，缩小前可进行平滑处理，
					如使用均值、高斯滤波其进行平滑。
		
		3.3.4 极坐标变换
						通常用来校正图像中圆形物体或被包含在圆环总的物体。
						由于将某个点变换到极坐标是相当耗时的运算(平方和反正切)，所以一般使用极坐标变换的逆变换。效率很高！
						
3.4 图像分割

		3.4.1 阈值分割
					 	Gmin <= Fr,c <= Gmax
					 	
					 	在灰度直方图中，一个好的阈值应该对应两个波峰之间的最小值，但由于灰度直方图中存在随机性。该最小值可能不能
					 	很好的固定。 一般需要采用一个一维高斯滤波器进行平滑处理。
					 	
					 	图像噪声太大，其灰度值过于分散。不均匀照明是导致期望峰值没有出现的一个原因。
					 	
					 	动态阈值分割处理：将图像与其局部背景进行比较的操作
					 				亮物体：  f(r,c) - g(r,c) >= gdiff
					 				暗物体    f(r,c) - g(r,c) <= -gdiff
					 		在动态阈值分割处理中，平滑滤波器的尺寸决定了能被分割出来的物体的尺寸，如果滤波器尺寸太小，那么物体的中心估计的背景
					 		将不理想。
					 		
					 		经验：均值滤波器的宽度必须大于被识别物体的宽度，这一规则适合中值、高斯滤波器，滤波尺寸越大，越有利于局部背景提取。
					 		
					 		对中值滤波来说，如果滤波半径大于被提取物体宽度时，滤波将会消除物体。
					 		
					 		因此，滤波尺寸足够大时，滤波后的灰度值就代表局部背景。但也不能无限大，因为相临近的物体可能对滤波产生不理的影响。
					 		
					 		注意：动态阈值分割不仅仅比局部背景更亮或更暗的物体，也包括亮区域或暗区域的边缘。
					 		
					 无干扰因素时，动态阈值分割还可以，如果是噪声很大时，会将噪声也带进来。
					 此时可使用偏差模型法： 无缺陷物体的图像为参考图像
					 			容许偏差：1) 从一组训练图像中获取
					 										ｍ(r,c) = １/n * sum(g(r,c))；　//图像平均值　－　类似时域平均法
					 										s(r,c) 为ｎ副图像的标准差，这里就是容许偏差
					 								2) 认为创建一些偏差，如将参考图像进行平移　(适合只能采集一副图像的情况下)
					 								3) 允许尺寸和位置存在小的公差，以此作为相应的最大偏差。(适合只能采集一副图像的情况下)
					 		  问题：如果引入的偏差非常小，说明训练图像的噪声明显小于正式检测时图像，或者物体一部分接近摄像机饱和极限时，此方法效果不好！
					 		  解决：为偏差图像引入一个绝对阈值，对认为太亮或太暗的像素引入两幅图形阈值，用u(r,c) 和l(r,c)表示阈值图像，
					 		  			ａ和ｂ表示绝对阈值，c和ｄ表示与标准偏差相乘的因素
					 		  则　：　u(r,c) = m(r,c) + max(a, cs(r,c))
					 		  				l(r,c) = m(r,c) - max(b, ds(r,c))
					 		  				

		3.4.2 提取连通区域
						一般使用4连通表示前景，8连通表示背景。
		
		3.4.3亚像素精度分割
						区域都是像素精度
						
						分割规则：  g>Gsub  与 g<Gsub 的边界
									从2x2区域反反复复选择图像第一个未被处理的线段作为轮廓第一段，然后跟踪邻近的线段直到轮廓闭合
									、到达图像边界或到达第一个交点。
						处理结果： 常量函数 g(r,c) = Gsub 与图像函数f(r,c)相交得到。
						
3.5 特征提取
	3.5.1 区域特征
	
						M(p,q) = ∑r(p)c(q) ; (r,c)∈R
			 面积: 0阶矩，p+q=0 => p=q=0; 
			 重心：归一化矩， p + q = 1;   (N0,1  N1,0)
			 中心矩： p + q = 2; 可以用来定义区域的方向和区域的范围
			 
			 椭圆的5个参数：(page164)
			 		r1:长轴
			 		r2:短轴
			 		θ：方向
			 		其中各项异性：r1/r2 :此特征在区域缩放时是保持恒定不变的，可用来描述一个区域的细长
			 									程度。
			 		等价椭圆：区域拥有相同的一阶矩和二阶矩。
			 		
			 		注意：椭圆参数存在两个问题：
			 		1) 只有在满足r1 ≠ r2 是才可以确定区域的方向；对正圆来说，方向没有意义。
			 		2) 由于底层的模型是一个椭圆，所以仅能以π为模确定方向，即先确定区域距离重心最远的点，
			 				然后用此点选择θ或θ+π作为正确方向。
			 				
			 基于矩的特征对特定变换保持不变，如平移、旋转、缩放，仿射变换。
			 
			 其他特征：
			 		最小平行轴外接矩形：区域矩形，基于区域横、纵坐标最小值、最大值计算。
			 		任意方向最小外接矩形：计算很复杂，有类似椭圆的参数。区域位置、方向、尺寸。
			 		最小外接圆：与任意方向最小外接矩形一样，首先计算区域凸包。
			 		
			 	凸包定义：
			 	凸性：区域的面积与凸包的面积之比，0-1之间。可用来筛选区域。
			 	
			 轮廓长度：像素水平、垂直线段	1，对角线2的平方根
			 轮廓的长度l与区域面积a关系：区域紧性c = l*l / (4πa)
			 	
			 
	3.5.2 灰度值特征
				最大值、最小值
				灰度平均值 = 区域所有灰度之和/区域面积；是对区域亮度的一个度量。
						对参考区域内灰度的平均值进行测量可以确定附加的亮度变化，此亮度是相对于系统最初
						设置时的情况而言。该特性在灰度值方差中应用一样。
						
				灰度值矩： p>=0, q>=0 (p,q)阶灰度值矩：
									m(p,q) = ∑g(r,c)r(p)c(q)
						(0,0)阶矩：灰度值面积，灰度值在区域内的"体积"。
						
				
	
	3.5.3 轮廓特征
		轮廓围绕的亚像素精度区域，也存在(p,q)阶矩。同时可以计算椭圆长轴，短轴，方向等参数。
				基于轮廓的特征 与 基于矩的区域特征和基于矩的灰度特征 类似：轮廓的重心和椭圆参数的准确度与灰度值
				重心相同 ； 轮廓的面积准确度比灰度值面积的准确度差些，真正的轮廓是圆，而线段总是位于
				轮廓周圆内部，但是轮廓还是可以用来检测的

3.6 形态学
	3.6.1 区域形态学
		背景的连通区域数 比 前景的孔洞数多1
		许多形态学分析时默认结构元是中心对称的，但从技术角度来说不正确。
		闵可夫斯基加法：要求结构元与区域至少存在一个公共点。结构元对称时效果与膨胀一致。		
		闵可夫斯基减法：要求结构元必须全部落在区域内。结构元对称时效果与腐蚀抑制		
		膨胀：使用转置后的结构元，进行闵可夫斯基加法。
		腐蚀：使用转置后的结构元，进行闽可夫斯基减法。
					腐蚀操作返回的是：腐蚀操作后结构元S平移后得到的参考点，这些点是在每次平移后的结构元St彻底落在区域R内得到的。
							腐蚀处理的行为效果类似于模板匹配。
		
		膨胀应用小技巧 --->>> 在OCR中识别遇到j i h等字符时先膨胀，再求交集。
		腐蚀应用       --->>> 密集物体分离中可用(土豆)，之后使用相同的结构结构元对连通区域做膨胀处理。								
		//////////////////////////////////////////////////////////////////////////////////////////////////
		
		注意：二值化图像的运算比行程法描述的区域或图像效率更高。
		
		总结：闽可夫斯基加法与减法互为对偶关系，不是互逆关系，同理，膨胀与腐蚀。
					对前景的一个膨胀处理等同于对背景的一个腐蚀处理。如果想要避免大量的运算以提高处理速度，注意使用此对偶性。
					注意：对偶型仅适用于当补集是无限的情况，所以不适合于二值图像。因为二值图像一定是某个区域的裁剪后的图像尺寸。
					膨胀与腐蚀最有用的地方是应用于计算区域边界
					
		击中 - 击不中： hit_or_miss
				返回平移后参考点，在这些参考点上，前景结构元Sf彻底落在前景内，而且背景结构元Sb彻底落在背景区域内。
					
		开操作：先进行腐蚀操作再接着已一个同样的结构元进行闽可夫斯基加法。开操作无需考虑参考点的位置，因此开操作相对于结构元是平移不变的。
						与腐蚀和膨胀比较，开操作是等幂的，及多次使用和一次使用结果一致。
				与腐蚀类似，开操作也能被用于模板匹配。它返回输入区域中能不结构元全部覆盖的点，因此保持了要搜索物体的形状。
				开操作能不用来抑制小物体。
				
		闭操作：线执行一个膨胀操作然后再用同一个结构元进行闵可夫斯基减法。闭操作相对结构元也是平移不变且幂等的。
		
		骨架：在某区域，所有极大圆圆心的集合。骨架的目的是保持区域的同伦，及保存连通区域与孔洞的数量不变。
					进行骨架算法在二值图像上实现比行程表示法更加有效。
		
		距离变换：先将距离图像初始化，令区域外的所有距离为0，区域内的所有距离值是一个选定的最大距离值(pow(2,b)-1) b是距离图像的像素位深。
					在halcon可以通过gray_min_max获取。
					返回的是一副图像，而不是一个区域。图像的像素是距离，这些距离代表区域R内每一个点到区域外(R补集)所有点的距离最小值。
							因此，区域边界上的点距离都是1，对区域内的点，通常计算他们的距离时考虑像素网格上对应的路径。4连通和8连通是不一样的。
							d4 = |r2-r1| + |c2-c1| ; 4连通区域，也即曼哈顿距离或城市街道距离
							d8 = max{|r2-r1|,|c2-c1|} ; 8连通区域，也即象棋格距离
							de = sqrt((r2-r1)*(r2-r1) + (c2-c1)*(c2-c1)) //欧式距离
								
							chamfer距离变换：在全图进行两种顺序逐行扫描，一种是从左上到右下，另一种则反之。每一种扫描中，都要在当前像素上放置一个
										掩码，及模板。然后将掩码覆盖区域中已有的距离值与掩码位置的元素灰度相机，待模板所有位置获取后从中求出最小值，作为当前像素
										距离值。
							chamfer-3-4倒角距离模板 ―> 前向模板和后向模板
										| 4 3 4 |      	| 			|
										| 3 0   |				|    	3	|
										|				|				| 4 3 4 |
							
							distance_transform: 支持city-block/chessboard/euclidean/chamfer-3-4/chamfer-3-4-unormalized/octagonal等距离变换	
										
	3.6.2 灰度值形态学
						从区域形态学推广而来，
						g(r,c) 表示被处理的图像, s(r,c)表示ROI S的一副图像，s也被称作为结构元。
						平坦结构元：对于(r,c)属于S时，s(r,c) = 0;
						灰度值膨胀与区域膨胀类似，扩大前景，收缩背景。灰度值腐蚀则反之。
						对偶性：对亮物体进行一个操作得到的结果与对暗物体进行一个对偶操作得到的结果完全一致，反之亦然。
						特性：当使用平坦元结构时，膨胀和腐蚀能被视为两种特殊的顺序滤波器。它们在结构元的范围内选择灰度值最小值和最大值；结构元可被视为滤波器掩码。
									因此，灰度值膨胀和腐蚀分别可用作最大值滤波器和最小值滤波器。
						
					灰度值闽可夫斯基加法： g (+) s
					灰度值闽可夫斯基减法： g (-) s
					灰度值开操作：灰度值腐蚀 + 灰度值闽可夫斯基加法；
					灰度值闭操作：灰度值膨胀 + 灰度值闽可夫斯基减法
							开/闭操作：填充小孔洞，或删除小物体。连接/分开物体或边界。
							
					-----> 一个应用：(page201)
						对于较大的缺陷，可以使用距离变换 + 骨架 进行金属线宽度检测。特点：像素精度，且至少两像素以上才能被可靠的检测。
						对于较小的缺陷，使用灰度值形态学更好：
								对pcb金属线上的突起(马刺、针孔、短路)进行开操作；对金属箱上的凹陷(鼠咬、断路)进行闭操作。之后图像得到平滑。
						为了检测这些缺陷，要求开操作和闭操作得到的两幅图像差异不能太大。开操作图像得到的灰度值总是小于闭操作图像得到的灰度值，
						使用动态阈值分割处理，提取灰度值超过gdiff的区域作为缺陷区域。dyn_threshold
						
				形态学梯度算子： gray_range_rect. 对存在受划痕、纹理、照明影响的情况特别有用!!!
						
3.7 边缘提取
			背景：基于阈值分割处理存在的缺陷，1，阈值必须选择正确且要有良好的鲁棒性，否则物体区域将变大或变小。
						2，当光照变化时稳定性经得起考验。
			因此，鲁棒性好的算法就是要尽可能不受影响的准确查找到物体的边界，最好的方法就是将边界视为图像中的边缘。
			
	3.7.1 1D、2D边缘定义
					1D边缘：1) 图像f(x)一阶导数f'(x)的绝对值|f'(x)|是局部最大值
									2) 二阶导数f''(x) = 0 ; f(x) 拐点且需要消除平坦拐点，满足f'(x) * f'''(x)即可。
						f'(x) > 0 :正边缘， f'(x) < 0 : 负边缘
					 
					2D边缘：二维边缘是一个曲线, s(t) = (r(t), c(t)) 其中t为参数，如用弧长表示。曲线上每个点与曲线垂直的灰度值剖面都是一个一维边缘。
							图像的梯度向量：图像函数f(r,c)最速上升方向，由图像一阶偏导数来确定。及局部最大值定义的边缘总是落在拐角内。对描述边缘较大的部分有优势
							拉普拉斯算子：算子过零；其定义的边缘通过拐角的顶点，且总是落在拐角外。对描述带锐利棱角的物体有优势。
					
					以上两个算子只有笔直的边缘两种算子返回才一致，其他任何弯曲明显的边缘，两种定义的结果都不一样。
								
	3.7.1 1D边缘提取: 通常用来确定物体的位置和尺寸
					真实图像是离散的，且包含噪声!
					
	
	3.7.2 2D边缘提取
	
	3.7.4 边缘的准确度
	
	
3.8 几何单元的分割与拟合
		
		
		
		
				
		
					
	
	
		
